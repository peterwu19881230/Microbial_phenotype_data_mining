#Goal: Create fractions (Generated by random selection of j (No. of genes in 3,4,...48 gene pathway) strains). If needed, I will have to use supercomputer to get the number

##How to run on ada?
#1.
#Objects or files needed: least10pcc.hclust_pcc_complete, ECK.Pathway_table, functions.R
load("distances_and_hclusts.RData"); load("ECK.Pathway_table.RData")
source("functions.R")


start.time=Sys.time()
  
##j=c(2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20,21,22,26,27,28,31,41,48) 

j=3 #Need to chage this guy to the above j and change the following k to like 5000. And then run that using super computer

##This block generates the fractions and so on. Resluts are in separate tables
hc=least10pcc.hclust_pcc_complete
for(i in j){
random_tables=list()
for (k in 1:10000){  ##How large should k be?
indices=sample(1:3979,i)
dat=data.frame(id=indices,tag=rep("random",i)) ##Give an arbitrary tag for the randomly picked up nodes
random_tables[[k]]=bottomUpExp(hc,dat)
}

avg.random_tables=list()
avg.fraction=c()
avg.elements=c()
NoOfElements=c()
for(l in 1:length(random_tables)){
  avg.fraction[l]=random_tables[[l]]$"Avg Fraction"
  avg.elements[l]=random_tables[[l]]$"Average Elements in the Cluster"
  NoOfElements[l]=random_tables[[l]]$"No of Elements for the tag"
}

avg.avg.fraction=mean(avg.fraction)
avg.avg.elements=mean(avg.elements)
avg.NoOfElements=mean(NoOfElements)
avg.random_tables=data.frame(tag="random",avg.avg.fraction,avg.avg.elements,avg.NoOfElements,avg.NoOfElements/avg.avg.elements)
file.name=paste("avg.random_tables.j",i,".RData",sep="")
save(avg.random_tables,file=file.name)
}


end.time=Sys.time()

time.taken=end.time-start.time
print(time.taken)
